{% extends 'base.html.twig' %}

{% block title %}Etat de stock | Paositra malagasy! {% endblock %}
{% block body %}
    <div class="row" >
        <div class="col-12">
            <div style="box-shadow: 2px 3px 9px 4px rgba(0,0,0,0.04);">
                <div class="q-container p-4">
                    <div class="row">
                        <div class="col">
                          <h2 class="q-title"><p style="color:#333940;" class="lead" > Situation du stocks: <span style="color:#498000;">{{ 'now' |format_date(locale='fr') }}</span></p> </h2>
                            <div class="q-display p-3">
                                <p class="d-inline">
                                <div id="sidebar">
                                <div class="clearfix">
                                    <span class="float-right" style="margin-top: 5px;">
                                        Selectionner les : <button type="button" class="btn btn-light" data-bs-toggle="modal" data-bs-target="#myModal"> Produits</button>
                                        <div class="modal" id="myModal">
                                            {{ form_start(form) }}
                                                <div class="modal-dialog">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <h5 class="modal-title"> Nom de produit </h5>
                                                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                                    </div>
                                                    {{ form_start(form) }}
                                                    <div class="modal-body">
                                                        <div class="form-group">
                                                                <label for="select">Nom de produit</label>
                                                                {{ form_widget(form.select, {'attr': {'class': 'form-control'}}) }}
                                                        </div>
                                                    </div>
                                                    <div class="modal-footer">
                                                            <div class="form-group">
                                                            {{ form_row(form.submit, { 'label': 'Selectionner' }) }}
                                                        </div>
                                                    </div>
                                                    {{ form_end(form) }}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                            {% if issubmitted == true %}
                                                <h4 class="text-danger"><label for="cars">Nom du produits :<em>{{ init.0.Produits }}</em></h4>
                                            {% endif %}
                                        <ul class="nav">
                                            <li class="nav-item dropdown">
                                                <a class="nav-link dropdown-toggle" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Par </a>
                                                <div class="dropdown-menu" aria-labelledby="dropdown09">
                                                    <a class="dropdown-item" href="#">Actuel</a>
                                                    <a class="dropdown-item" href="{{ path('periode_mensuel', {'source':'etat mensuel'}) }}">Mensuel</a>
                                                    <a class="dropdown-item" href="{{ path('periode_annuel', {'source':'etat annuel'}) }}">Annuel</a>
                                                </div>
                                            </li>
                                            <li>
                                             {% if isDate == true %}
                                                {{ form_start(formD) }}
                                                     {{ form_widget(formD) }}
                                                {{ form_end(formD) }}
                                             {% endif %}
                                            </li>
                                        </ul>
                                    </span> 
                                </div>                         
                                   <div class="table responsive-xxl">
                                        <table class="table table-striped table-bordered table-hover" data-toggle="table" data-search="true">
                                            <thead>
                                                <tr class="table-danger">
                                                    <th data-sortable="true" data-field="Ordre"> Ordre</th>
                                                    {% if issubmitted == false %}
                                                        <th data-field="Categorie"> Produit </th>
                                                    {% endif %}
                                                    <th data-field="produit"> Categorie </th>
                                                    <th data-field="Valeur Faciales">Valeur Faciales</th>
                                                    <th data-field="Stock initial">Stock initial</th>
                                                    <th data-field="Entrée">Entrée</th>
                                                    <th data-field="Sortie">Sortie</th>
                                                    <th data-field="Sock Actuel">Stock Acteul </th>
                                                    
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for key,value in courant %}
                                                      <tr>
                                                        {% for key2, value2 in value %} 
                                                            
                                                            {% if key2 =='ordre' %}
                                                                <td> {{ value2 }}  </td>
                                                            {% elseif key2 =='NomDeCategorie' %}
                                                                <td> {{ value2 }} </td>  
                                                            {% elseif key2 =='produit' %}
                                                                <td> {{ value2 }} </td>
                                                            {% elseif key2 =='valeurFaciale' %}
                                                                <td> {{ value2 }} </td>
                                                            {% elseif key2 =='initiale' %}
                                                                <td> {{ initial[key][0] }} </td> 
                                                            {% elseif key2 =='entrer' %}
                                                                <td> {{ entree[key][0] - initial[key][0] }} </td> 
                                                            {% elseif key2 =='sortie' %}
                                                                {% if out is empty %}
                                                                    <td> 0 </td> 
                                                                {% else %}
                                                                    <td> {{ out[key][0]|abs }} </td>
                                                                {% endif %} 
                                                            {% elseif key2 =='actuelle' %}
                                                                <td> {{ value2 }} </td>                                                                                                                   
                                                            {% endif %}
                                                        {% endfor %}
                                                    </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                   </div>
                                </p>
                                <div class="d-flex flex-row-reverse bd-highlight">
                                    <div class="p-2 bd-highlight">
                                        <p> Antananarivo le ,{{ 'now' |format_date(locale='fr') }} </p>

                                        <p><span> Chef de  Centre d'Approvisionnement en Valeurs Postales </span></p>
                                            {{ app.user.prenom }}
                                            {% if issubmitted == false %}
                                                <p> <a href="{{ path('impression_product') }}" target="_blank" style="color: #fff; text-decoration:none;"><button class="btn btn-outline-danger" >Imprimer ce fichier generale</button></a></p>
                                            {% else %}
                                                <p> <a href="{{ path('impression_select',{id: init.0.id}) }}" target="_blank" style="color: #fff; text-decoration:none;"><button class="btn btn-outline-danger" >Imprimer ce fichier</button></a></p>
                                            {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    

{% endblock %}

